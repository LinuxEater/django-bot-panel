{% extends "core/base.html" %}
{% block title %}Painel - Bot Panel{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3">Tarefas</h1>
    <a href="{% url 'task_create' %}" class="btn btn-primary">+ Nova tarefa</a>
</div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Nome</th>
            <th>URL</th>
            <th>Ativa</th>
            <th>Ações</th>
        </tr>
    </thead>
    <tbody>
    {% for task in tasks %}
        <tr>
            <td>{{ task.name }}</td>
            <td><a href="{{ task.url }}" target="_blank">{{ task.url|truncatechars:40 }}</a></td>
            <td>
                {% if task.active %}
                    <span class="badge bg-success">Sim</span>
                {% else %}
                    <span class="badge bg-secondary">Não</span>
                {% endif %}
            </td>
            <td>
                <a href="{% url 'task_edit' task.pk %}" class="btn btn-sm btn-warning">Editar</a>
                <a href="{% url 'task_toggle' task.pk %}" class="btn btn-sm btn-info">Ativar/Desativar</a>
                <a href="{% url 'test_scrape' task.pk %}" class="btn btn-sm btn-dark">Testar</a>
                <a href="{% url 'task_delete' task.pk %}" class="btn btn-sm btn-danger"
                   onclick="return confirm('Tem certeza que deseja excluir?')">Excluir</a>
            </td>
        </tr>
    {% empty %}
        <tr><td colspan="4" class="text-center">Nenhuma tarefa cadastrada</td></tr>
    {% endfor %}
    </tbody>
</table>

<hr>
<h2 class="h5 mt-4">Últimos Logs</h2>
<ul class="list-group">
    {% for log in logs %}
        <li class="list-group-item">
            <strong>[{{ log.created_at|date:'d/m H:i' }}]</strong>
            {{ log.task.name }} → {{ log.message }}
        </li>
    {% empty %}
        <li class="list-group-item">Nenhum log disponível</li>
    {% endfor %}
</ul>

{% endblock %}
